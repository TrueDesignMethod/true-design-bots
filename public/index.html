<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
 <!-- Montserrat -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<title>TRUE â€” Life Design</title>
<style>
  :root{
    --bg: #fbf9f7;
    --card: #ffffff;
    --muted: #6b5b54;
    --accent: #8b5e3c;
    --accent-soft: #cfa68a;
    --text: #1f1a18;

    --controls-bg: #232428;
    --controls-text: #ffffff;
    --controls-muted: #d6d6d8;
    --controls-border: rgba(255,255,255,0.06);
    --controls-radius: 12px;
    --controls-padding: 10px 12px;

    --assistant-bubble: #f4f2ef;
    --user-bubble: #e5d9d0;
    --input-bg: #f4f2ef;
    --input-border: rgba(16,18,20,0.05);

    /* preserve geometry value used elsewhere */
    --round: 12px;
  }

  body {
    font-family: 'Montserrat', Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
    margin: 0;
    background: var(--bg);
    color: var(--text);
  }
  .wrap { max-width: 920px; margin: 28px auto; padding: 20px; }
  header { display:flex; justify-content:space-between; align-items:center; gap:16px; }
  h1 { margin:0; font-size:20px; color: var(--text); }
  .stage-controls {
  display: flex;
  gap: 8px;
}

.stage-btn {
  padding: 8px 12px;
  border-radius: 10px;
  background: linear-gradient(180deg, var(--card), var(--assistant-bubble));
  border: 1px solid var(--input-border);
  cursor: pointer;
  color: var(--muted);
  font-family: 'Montserrat', sans-serif;
}

.stage-btn.active {
  background: #000000;
  color: #ffffff;
  border-color: #000000;
  box-shadow: 0 6px 22px rgba(0,0,0,0.25);
}

  main { margin-top:18px; display:grid; grid-template-columns: 1fr 360px; gap:18px; }
  .chat-panel {
    background: var(--card);
    border-radius:var(--round);
    padding:14px;
    min-height:520px;
    border:1px solid var(--input-border);
    display:flex;
    flex-direction:column;
  }
 

  /* Fixed message height (was 4200px accidentally) */
  #messages { height:420px; overflow:auto; padding:8px; display:flex; flex-direction:column; gap:8px; }
  .bubble { max-width:78%; padding:10px 12px; border-radius:12px; line-height:1.35; }
  .bubble.bot {
    background: var(--assistant-bubble);
    align-self:flex-start;
    border:1px solid var(--input-border);
    color: var(--text);
  }
  .bubble.user {
    background: var(--user-bubble);
    color: var(--text);
    align-self:flex-end;
  }

  .meta { font-size:12px; color:var(--muted); margin-top:6px; }
  .input-area { display:flex; gap:8px; margin-top:10px; align-items:flex-end; flex-direction:column; }
  .input-row { display:flex; gap:8px; width:100%; align-items:flex-end; }

  textarea {
    width:100%;
    border-radius:10px;
    padding:10px;
    border:1px solid var(--input-border);
    min-height:72px;
    resize:vertical;
    background: var(--input-bg);
    color: var(--text);
  }

  button.primary {
  background: #000000;
  color: #ffffff;
  border: none;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-family: 'Montserrat', sans-serif;
  box-shadow: 0 6px 20px rgba(0,0,0,0.25);
}

  .options { display:flex; gap:8px; margin-top:8px; flex-wrap:wrap; }
  .option-btn {
    background: var(--card);
    border:1px solid var(--input-border);
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
    color:var(--text);
  }

  .loading { font-size:13px; color:var(--muted); }
  .small { font-size:13px; color:var(--muted); }

  .export-btn,
a.download-link {
  display: block;
  margin-top: 14px;
  padding: 8px 12px;
  border-radius: 10px;

  background: var(--card);
  color: var(--muted);
  text-decoration: none;

  border: 1px solid var(--input-border); /* matches stage buttons */
  font-family: 'Montserrat', sans-serif;
  cursor: pointer;
  transition: background .12s ease, box-shadow .12s ease;
}

.export-btn:hover,
a.download-link:hover {
  background: var(--assistant-bubble);
  box-shadow: 0 4px 10px rgba(16,18,20,0.04);
}


  pre.snapshot { white-space:pre-wrap; font-family:inherit; color:var(--muted); }
  select#starter-select {
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid var(--input-border);
    background: var(--input-bg);
    color: var(--text);
  }

  .privacy { margin-top:10px; font-size:13px; }
  .privacy a { color:var(--accent); text-decoration:none; }

  /* Header title */
h1.app-title {
  margin: 0;
  font-size: 20px;
  font-family: 'Montserrat', sans-serif;
  font-weight: 400; /* removes bold */
  color: var(--text);
}

/* TD square icon */
.td-icon {
  width: 34px;
  height: 34px;
  border-radius: 8px;
  background: #000000;
  color: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Montserrat', sans-serif;
  font-size: 14px;
  font-weight: 600;
}

</style>

</head>
<body>
  <div class="wrap">
   <header>
  <div style="display:flex; align-items:center; gap:10px;">
    <div class="td-icon">TD</div>
    <h1 class="app-title">TRUE AI</h1>
  </div>
 <div class="stage-controls">
    <button class="stage-btn active" data-stage="Discovery">Discovery</button>
    <button class="stage-btn" data-stage="Planning">Planning</button>
    <button class="stage-btn" data-stage="Alignment">Alignment</button>
  </div>
</header>


   <main>
<section class="chat-panel">
  <div id="messages"></div>

  <div style="margin-top:auto">
    <textarea id="user-input" placeholder="Write what you'd like to exploreâ€¦"></textarea>
    <button id="send-btn" class="primary">Send</button>
    <div class="small">TRUE listens for what matters and responds reflectively.</div>
    
  </div>
</section>

<aside class="sidebar">
  <strong>Stage</strong>
  <div id="stage-desc" class="small" style="margin-top:8px">
    TRUE Discovery: Clarify values, motivations, strengths, and starting point.
  </div>

  <hr>

  <strong>Move between stages</strong>
  <button class="option-btn" data-stage-switch="Discovery">Discovery</button>
  <button class="option-btn" data-stage-switch="Planning">Planning</button>
  <button class="option-btn" data-stage-switch="Alignment">Alignment</button>

  <hr>

  <strong>Session</strong>
  <button class="option-btn" id="restart-btn">Start over</button>
</aside>
</main>
</div>

<script type="module">
import { sendMessage } from "./send.js";

let currentStage = "Discovery";
let conversation = [];

const messagesEl = document.getElementById("messages");
const inputEl = document.getElementById("user-input");
const stageDesc = document.getElementById("stage-desc");

function appendBubble(text, who="bot"){
  const d=document.createElement("div");
  d.className="bubble "+who;
  d.textContent=text;
  messagesEl.appendChild(d);
  messagesEl.scrollTop=messagesEl.scrollHeight;
}

function setStage(stage){
  currentStage=stage;
  document.querySelectorAll(".stage-btn").forEach(b=>{
    b.classList.toggle("active",b.dataset.stage===stage);
  });
  stageDesc.textContent={
    Discovery:"TRUE Discovery: Clarify values, motivations, strengths, and starting point.",
    Planning:"TRUE Planning: Translate insight into realistic, sustainable action.",
    Alignment:"TRUE Alignment: Maintain balance, resilience, and long-term integrity."
  }[stage];
}

document.querySelectorAll(".stage-btn,[data-stage-switch]").forEach(btn=>{
  btn.addEventListener("click",()=>setStage(btn.dataset.stage||btn.dataset.stageSwitch));
});

document.getElementById("send-btn").addEventListener("click",async()=>{
  const text=inputEl.value.trim();
  if(!text)return;
  inputEl.value="";
  appendBubble(text,"user");
  conversation.push({role:"user",content:text});

  appendBubble("Reflectingâ€¦","bot");
  const res = await sendMessage(currentStage, conversation);

// ðŸ” DEBUG: See routing decisions
console.log("TRUE DEBUG RESPONSE:", {
  stage: res.stage,
  intent: res.intent,
  module: res.module
});

messagesEl.lastChild.remove();

if (!res.reply) {
  appendBubble("Iâ€™m here, but something went wrong generating a response. Please try again.", "bot");
  console.error("TRUE ERROR: No reply returned", res);
  return;
}

appendBubble(res.reply, "bot");
console.log("TRUE RAW REPLY:", res.reply);


  conversation.push({role:"assistant",content:res.reply});
});

document.getElementById("restart-btn").addEventListener("click",()=>{
  conversation=[];
  messagesEl.innerHTML="";
  appendBubble("Welcome. Iâ€™m TRUE.\n\nYou can begin by writing what feels important right now.","bot");
});

appendBubble("Welcome. Iâ€™m TRUE.\n\nYou can begin by writing what feels important right now.","bot");
</script>
</body>
</html>
